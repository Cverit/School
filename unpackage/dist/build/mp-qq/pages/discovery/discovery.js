(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/discovery/discovery"],{"0e8c":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement;t._self._c},a=[];i.d(e,"a",function(){return o}),i.d(e,"b",function(){return a})},9803:function(t,e,i){"use strict";i.r(e);var o=i("0e8c"),a=i("f261");for(var n in a)"default"!==n&&function(t){i.d(e,t,function(){return a[t]})}(n);i("a691");var s=i("2877"),r=Object(s["a"])(a["default"],o["a"],o["b"],!1,null,null,null);e["default"]=r.exports},c1e6:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i("2f62");function a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),o.forEach(function(e){n(t,e,i[e])})}return t}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var s={data:function(){return{TabCur:0,menu_list:["美食","娱乐","住宿","运动"],food_list:[],play_list:[],live_list:[],sport_list:[],search_list:[],scroll_left:0,scroll_height:600,screen_height:800,screen_width:400,search_keywords:"",foodCurrentPage:1,playCurrentPage:1,liveCurrentPage:1,sportCurrentPage:1,searchCurrentPage:1,loading:!0}},computed:a({},(0,o.mapState)({location:function(t){return t.UserLocation},map_poi:function(t){return t.MapPoi}}),{userLocation:function(){return null==this.location.user_address?"获取定位...":this.location.user_address_component.district+this.location.user_address_component.street},display_location:function(){return null!=this.location.user_address}}),watch:{"$store.state.MapPoi.search_keyword":function(){var t=this;""!=this.map_poi.search_keyword&&(this.TabCur=4,this.scroll_left=this.screen_width/4*3,this.$store.dispatch("getAroundPoi",{latitude:this.location.user_location.latitude,longitude:this.location.user_location.longitude,keywords:this.map_poi.search_keyword,page:1,extensions:"base",sortrule:"weight"}).then(function(e){t.search_list=t.formatPoi(e.data.pois),t.loading=!1}))}},mounted:function(){var t=this;this.initPoi(),setTimeout(function(){t.getHeight()},100)},destroyed:function(){this.$store.dispatch("initSearchKeyword")},methods:{afterOpenSetting:function(t){var e=this;t.detail.authSetting["scope.userLocation"]&&this.$store.dispatch("requestUserLocation").then(function(t){e.loading=!0,setTimeout(function(){0==e.location.user_location.latitude?setTimeout(function(){e.initPoi(),e.getHeight()},500):(e.initPoi(),e.getHeight())},500)})},loadNextPage:function(t){var e=this;if(!this.loading){this.currentPage++,this.loading=!0;var i="",o=0;switch(t){case"food":i="美食",this.foodCurrentPage++,o=this.foodCurrentPage;break;case"play":i="娱乐",this.playCurrentPage++,o=this.playCurrentPage;break;case"live":i="住宿",this.liveCurrentPage++,o=this.liveCurrentPage;break;case"sport":i="运动场馆",this.sportCurrentPage++,o=this.sportCurrentPage;break;case"search":i=this.map_poi.search_keyword,this.searchCurrentPage++,o=this.searchCurrentPage;break}this.$store.dispatch("getAroundPoi",{latitude:this.location.user_location.latitude,longitude:this.location.user_location.longitude,keywords:i,page:o,radius:6e3,extensions:"base",sortrule:"weight"}).then(function(i){switch(t){case"food":e.food_list.push.apply(e.food_list,e.formatPoi(i.data.pois));break;case"play":e.play_list.push.apply(e.play_list,e.formatPoi(i.data.pois));break;case"live":e.live_list.push.apply(e.live_list,e.formatPoi(i.data.pois));break;case"sport":e.sport_list.push.apply(e.sport_list,e.formatPoi(i.data.pois));break;case"search":e.search_list.push.apply(e.search_list,e.formatPoi(i.data.pois));break}e.loading=!1})}},getHeight:function(){var e=this;t.getSystemInfo({success:function(i){e.screen_height=i.windowHeight,e.screen_width=i.windowWidth;var o=t.createSelectorQuery().in(e);o.select("#swiper").boundingClientRect(function(t){e.scroll_height=e.screen_height-t.top}).exec()}})},initPoi:function(){var t=this;this.$store.dispatch("getAroundPoi",{latitude:this.location.user_location.latitude,longitude:this.location.user_location.longitude,keywords:"美食",page:1,radius:6e3,extensions:"base",sortrule:"weight"}).then(function(e){t.food_list=t.formatPoi(e.data.pois),t.loading=!1}),this.$store.dispatch("getAroundPoi",{latitude:this.location.user_location.latitude,longitude:this.location.user_location.longitude,keywords:"娱乐",page:1,radius:6e3,extensions:"base",sortrule:"weight"}).then(function(e){t.play_list=t.formatPoi(e.data.pois),t.loading=!1}),this.$store.dispatch("getAroundPoi",{latitude:this.location.user_location.latitude,longitude:this.location.user_location.longitude,keywords:"住宿",page:1,radius:6e3,extensions:"base",sortrule:"weight"}).then(function(e){t.live_list=t.formatPoi(e.data.pois),t.loading=!1}),this.$store.dispatch("getAroundPoi",{latitude:this.location.user_location.latitude,longitude:this.location.user_location.longitude,keywords:"运动场馆",page:1,radius:6e3,extensions:"base",sortrule:"weight"}).then(function(e){t.sport_list=t.formatPoi(e.data.pois),t.loading=!1})},formatPoi:function(t){for(var e in t){if(""!=t[e].tel){var i=t[e].tel.split(";");t[e].tel=i[0]}t[e].distance/1e3<1?t[e].distance=t[e].distance+"m":t[e].distance=(t[e].distance/1e3).toFixed(1)+"km"}return t},tabSelect:function(t){this.TabCur=t.currentTarget.dataset.id,this.scroll_left=(t.currentTarget.dataset.id-1)*(this.screen_width/4)},tabSwiper:function(t){this.TabCur=t.detail.current,this.scroll_left=(this.TabCur-1)*(this.screen_width/4)},navigateLocation:function(){t.navigateTo({url:"/pages/location/location"})},navigateSearch:function(){t.navigateTo({url:"/pages/search/search"})}}};e.default=s}).call(this,i("a821")["default"])},f261:function(t,e,i){"use strict";i.r(e);var o=i("c1e6"),a=i.n(o);for(var n in o)"default"!==n&&function(t){i.d(e,t,function(){return o[t]})}(n);e["default"]=a.a},f4ff:function(t,e,i){"use strict";(function(t){i("499b"),i("921b");o(i("66fd"));var e=o(i("9803"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("a821")["createPage"])}},[["f4ff","common/runtime","common/vendor"]]]);